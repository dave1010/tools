<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shareable Message</title>
  <link rel="stylesheet" href="/assets/tw.css" />
</head>
<body class="bg-brand-50 text-gray-900">
  <main class="relative mx-auto max-w-3xl p-4 md:p-6 space-y-4 font-sans">
    <button id="clearLink" class="hidden absolute right-4 top-4 rounded-full border border-gray-200 bg-white px-2 py-1 text-xs font-semibold text-gray-500 shadow-sm hover:text-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2" aria-label="Clear shared text and start over">×</button>

    <section id="editor" class="space-y-4">
      <header class="space-y-2">
        <p class="inline-flex items-center rounded-full bg-brand-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-brand-700">Message Link</p>
        <h1 class="text-3xl font-bold text-gray-900">Share a quick message</h1>
        <p class="text-gray-600">Type a note and the page keeps the URL updated with a shareable, base64-encoded copy.</p>
      </header>

      <div class="space-y-2">
        <label for="messageInput" class="block text-sm font-medium text-gray-800">Your message</label>
        <textarea id="messageInput" class="w-full rounded-lg border border-gray-200 bg-white p-3 text-base shadow-sm focus:border-brand-500 focus:ring-2 focus:ring-brand-200" rows="6" placeholder="Start typing to generate a shareable link..."></textarea>
        <p class="text-sm text-gray-600">Anyone opening the link will see exactly what you wrote.</p>
      </div>

      <div class="rounded-lg border border-dashed border-brand-200 bg-white/70 p-3 text-sm text-gray-700">
        <p class="font-semibold text-gray-800">Share link</p>
        <p id="shareUrl" class="break-all text-gray-600"></p>
      </div>
    </section>

    <section id="viewer" class="hidden space-y-4">
      <div class="rounded-xl bg-white p-4 shadow-sm">
        <h2 class="sr-only">Shared message</h2>
        <p id="sharedMessage" class="whitespace-pre-wrap text-lg text-gray-900"></p>
      </div>
    </section>
  </main>

  <footer id="pageFooter" class="py-6 text-center text-sm text-gray-500">
    <div class="flex justify-center gap-4">
      <a href="/" class="font-medium text-brand-700 hover:text-brand-600">← Back to tools.dave.engineer</a>
      <a href="https://github.com/dave1010/tools/tree/main/tools/shareable-message" class="font-medium text-brand-700 hover:text-brand-600">About</a>
    </div>
  </footer>

  <script>
    const editor = document.getElementById('editor');
    const viewer = document.getElementById('viewer');
    const footer = document.getElementById('pageFooter');
    const messageInput = document.getElementById('messageInput');
    const shareUrl = document.getElementById('shareUrl');
    const sharedMessage = document.getElementById('sharedMessage');
    const clearLink = document.getElementById('clearLink');

    const encodeText = (text) => btoa(unescape(encodeURIComponent(text)));
    const decodeText = (text) => decodeURIComponent(escape(atob(text)));

    const updateShareUrl = (text) => {
      const params = new URLSearchParams();
      let newUrl = window.location.pathname;

      if (text) {
        params.set('text', encodeText(text));
        newUrl = `${window.location.pathname}?${params.toString()}`;
      }

      history.replaceState(null, '', newUrl);
      shareUrl.textContent = `${window.location.origin}${newUrl}`;
    };

    const showEditor = () => {
      editor.classList.remove('hidden');
      viewer.classList.add('hidden');
      clearLink.classList.add('hidden');
      footer.classList.remove('hidden');
      messageInput.removeAttribute('disabled');
      messageInput.focus();
      updateShareUrl(messageInput.value);
    };

    const showViewer = (text) => {
      sharedMessage.textContent = text;
      viewer.classList.remove('hidden');
      editor.classList.add('hidden');
      clearLink.classList.remove('hidden');
      footer.classList.add('hidden');
    };

    clearLink.addEventListener('click', () => {
      history.replaceState(null, '', window.location.pathname);
      messageInput.value = '';
      showEditor();
    });

    messageInput.addEventListener('input', (event) => {
      const value = event.target.value;
      updateShareUrl(value);
    });

    const params = new URLSearchParams(window.location.search);
    const sharedParam = params.get('text');

    if (sharedParam) {
      try {
        const decoded = decodeText(sharedParam);
        showViewer(decoded);
      } catch (error) {
        showViewer('Unable to decode shared message.');
      }
    } else {
      shareUrl.textContent = window.location.href;
      showEditor();
    }
  </script>
</body>
</html>
