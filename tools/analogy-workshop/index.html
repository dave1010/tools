<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analogy Workshop</title>
    <link rel="stylesheet" href="/assets/tw.css" />
  </head>
  <body class="bg-gradient-to-b from-brand-50/70 to-white">
    <main class="mx-auto max-w-3xl space-y-6 p-4 font-sans md:p-6">
      <header class="space-y-2 text-center">
        <h1 class="text-3xl font-semibold text-gray-900">Analogy Workshop</h1>
        <p class="text-sm text-gray-600">
          Craft vivid analogies that translate complex ideas for any audience.
        </p>
      </header>

      <section class="rounded-2xl bg-white p-6 shadow">
        <form id="analogyForm" class="space-y-5">
          <label class="space-y-2">
            <span class="block text-sm font-medium text-gray-700">What do you need to explain?</span>
            <textarea
              id="concept"
              class="w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/40"
              rows="4"
              placeholder="Summarize the idea, feature, or process you want to make relatable."
              required
            ></textarea>
          </label>

          <div class="grid gap-4 md:grid-cols-2">
            <label class="space-y-2">
              <span class="block text-sm font-medium text-gray-700">Audience</span>
              <input
                id="audience"
                type="text"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/40"
                placeholder="e.g. high-school biology class, fintech investors"
              />
            </label>

            <label class="space-y-2">
              <span class="block text-sm font-medium text-gray-700">Angle</span>
              <select
                id="angle"
                class="w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/40"
              >
                <option value="clarity" selected>Make it simple</option>
                <option value="story">Tell it as a story</option>
                <option value="technical">Keep technical depth</option>
                <option value="motivation">Highlight why it matters</option>
              </select>
            </label>
          </div>

          <label class="space-y-2">
            <span class="flex items-center justify-between text-sm font-medium text-gray-700">
              <span>Number of analogies</span>
              <span id="countLabel" class="font-mono text-gray-500">3</span>
            </span>
            <input
              id="analogyCount"
              type="range"
              min="2"
              max="6"
              step="1"
              value="3"
              class="w-full"
            />
          </label>

          <label class="space-y-2">
            <span class="block text-sm font-medium text-gray-700">Must-hit points (optional)</span>
            <textarea
              id="mustInclude"
              class="w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/40"
              rows="2"
              placeholder="List key qualities, metaphors to avoid, or comparisons you have already tried."
            ></textarea>
          </label>

          <div class="flex flex-wrap items-center justify-end gap-3 pt-2">
            <button
              id="clearButton"
              type="button"
              class="btn btn-secondary"
            >
              Clear
            </button>
            <button
              id="generateButton"
              type="submit"
              class="btn btn-primary"
            >
              Generate analogies
            </button>
          </div>
        </form>
        <p id="status" class="mt-4 hidden text-sm"></p>
      </section>

      <section id="resultsSection" class="hidden space-y-4 rounded-2xl bg-white p-6 shadow">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-base font-semibold text-gray-900">Analogy set</h2>
          <button id="copyButton" type="button" class="btn btn-secondary">Copy</button>
        </div>
        <pre id="results" class="whitespace-pre-wrap rounded-xl bg-brand-50/50 p-4 text-sm text-gray-900"></pre>
      </section>

      <section class="rounded-2xl bg-white p-6 shadow">
        <h2 class="text-base font-semibold text-gray-900">Tips</h2>
        <ul class="mt-3 list-disc space-y-2 pl-6 text-sm text-gray-600">
          <li>Be specific about tricky details that usually confuse people.</li>
          <li>Mention tones to avoid (&ldquo;no hype&rdquo;, &ldquo;skip war analogies&rdquo;) in the must-hit points box.</li>
          <li>Use the angle selector to choose between clarity, narrative, technical depth, or motivation.</li>
        </ul>
      </section>

      <footer class="py-6 text-center text-sm text-gray-500">
        <div class="flex justify-center gap-4">
          <a href="/" class="font-medium text-brand-700 hover:text-brand-600">← Back to tools.dave.engineer</a>
          <a
            href="https://github.com/dave1010/tools/tree/main/tools/analogy-workshop"
            class="font-medium text-brand-700 hover:text-brand-600"
            >About</a
          >
        </div>
      </footer>
    </main>

    <script>
      const form = document.getElementById("analogyForm");
      const statusEl = document.getElementById("status");
      const resultsSection = document.getElementById("resultsSection");
      const resultsEl = document.getElementById("results");
      const generateButton = document.getElementById("generateButton");
      const clearButton = document.getElementById("clearButton");
      const copyButton = document.getElementById("copyButton");
      const countInput = document.getElementById("analogyCount");
      const countLabel = document.getElementById("countLabel");

      const SYSTEM_PROMPT = `You are "Analogy Workshop", an assistant that crafts vivid, accurate analogies. Respond in clear Markdown. Begin with a one-sentence guidance line titled "How to use these analogies". Then provide a bulleted list where each bullet starts with a bold analogy title followed by a colon, a concise analogy, and a second sentence explaining why it fits the audience. Avoid repeating themes. End with a short tip on how to adapt the analogies. Do not include code fences.`;

      countInput.addEventListener("input", () => {
        countLabel.textContent = countInput.value;
      });

      function setStatus(message, isError = false) {
        if (!message) {
          statusEl.classList.add("hidden");
          statusEl.textContent = "";
          return;
        }
        statusEl.textContent = message;
        statusEl.classList.remove("hidden");
        statusEl.classList.toggle("text-red-600", isError);
        statusEl.classList.toggle("text-gray-600", !isError);
      }

      function toggleLoading(isLoading) {
        generateButton.disabled = isLoading;
        clearButton.disabled = isLoading;
        generateButton.textContent = isLoading ? "Generating…" : "Generate analogies";
      }

      function buildUserPrompt({ concept, audience, angle, mustInclude, count }) {
        const parts = [
          `Concept to explain: ${concept.trim()}`,
          audience ? `Audience: ${audience.trim()}` : "Audience: general readers",
          `Preferred angle: ${angle}`,
          `Number of analogies: ${count}`,
        ];
        if (mustInclude.trim()) {
          parts.push(`Additional guidance: ${mustInclude.trim()}`);
        }
        parts.push(
          "Ensure analogies are distinct and rooted in concrete imagery. Mention caveats when necessary, and avoid any analogy types the user says to skip."
        );
        return parts.join("\n");
      }

      async function generateAnalogies(payload) {
        toggleLoading(true);
        setStatus("Calling Cerebras…");
        resultsSection.classList.add("hidden");
        try {
          const response = await fetch("/cerebras-chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            let errorMessage = `Request failed (${response.status})`;
            try {
              const errorData = await response.json();
              errorMessage = errorData?.error || errorData?.message || errorMessage;
            } catch (error) {
              errorMessage = await response.text();
            }
            throw new Error(errorMessage);
          }

          const data = await response.json();
          const content = data?.choices?.[0]?.message?.content?.trim();
          if (!content) {
            throw new Error("The model returned an empty response.");
          }

          resultsEl.textContent = content;
          resultsSection.classList.remove("hidden");
          copyButton.disabled = false;
          setStatus("Analogies ready. Share and adapt them for your audience.");
        } catch (error) {
          console.error("Failed to generate analogies", error);
          setStatus(error.message || "Unexpected error", true);
        } finally {
          toggleLoading(false);
        }
      }

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const concept = document.getElementById("concept").value;
        if (!concept.trim()) {
          setStatus("Describe the concept first.", true);
          return;
        }

        const payload = {
          model: "gpt-oss-120b",
          messages: [
            { role: "system", content: SYSTEM_PROMPT },
            {
              role: "user",
              content: buildUserPrompt({
                concept,
                audience: document.getElementById("audience").value,
                angle: document.getElementById("angle").value,
                mustInclude: document.getElementById("mustInclude").value,
                count: countInput.value,
              }),
            },
          ],
        };

        generateAnalogies(payload);
      });

      clearButton.addEventListener("click", () => {
        if (generateButton.disabled) {
          return;
        }
        form.reset();
        countInput.value = "3";
        countLabel.textContent = "3";
        resultsSection.classList.add("hidden");
        resultsEl.textContent = "";
        copyButton.disabled = true;
        setStatus("");
        document.getElementById("concept").focus();
      });

      copyButton.addEventListener("click", async () => {
        if (!resultsEl.textContent) {
          return;
        }
        try {
          await navigator.clipboard.writeText(resultsEl.textContent);
          setStatus("Copied to clipboard. Keep tailoring the language for your readers.");
        } catch (error) {
          console.error("Copy failed", error);
          setStatus("Could not copy to clipboard. Copy manually.", true);
        }
      });

      copyButton.disabled = true;
    </script>
  </body>
</html>
