<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Decision Matrix Builder</title>
    <link rel="stylesheet" href="/assets/tw.css" />
  </head>
  <body class="bg-slate-50 text-slate-900">
    <main class="mx-auto max-w-3xl p-4 md:p-6 space-y-4 font-sans">
      <header class="space-y-2">
        <p class="text-sm font-semibold uppercase tracking-wide text-brand-600">
          Productivity & Writing
        </p>
        <h1 class="text-3xl font-semibold text-slate-900">Decision Matrix Builder</h1>
        <p class="text-slate-600">
          Compare options by weighting the criteria that matter most.
        </p>
      </header>

      <section class="grid gap-4 md:grid-cols-2">
        <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
          <div class="flex items-center justify-between gap-2">
            <h2 class="text-lg font-semibold">Criteria & Weights</h2>
            <button id="add-criterion" class="btn btn-secondary">Add</button>
          </div>
          <div id="criteria-list" class="mt-4 space-y-3"></div>
        </div>

        <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
          <div class="flex items-center justify-between gap-2">
            <h2 class="text-lg font-semibold">Options</h2>
            <button id="add-option" class="btn btn-secondary">Add</button>
          </div>
          <div id="options-list" class="mt-4 space-y-3"></div>
        </div>
      </section>

      <section class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-lg font-semibold">Score Matrix</h2>
          <div class="text-sm text-slate-500">
            Scores are multiplied by weight, then summed.
          </div>
        </div>
        <div id="matrix" class="mt-4 overflow-x-auto"></div>
      </section>

      <footer class="py-6 text-center text-sm text-gray-500">
        <div class="flex justify-center gap-4">
          <a href="/" class="font-medium text-brand-700 hover:text-brand-600"
            >← Back to tools.dave.engineer</a
          >
          <a
            href="https://github.com/dave1010/tools/tree/main/tools/decision-matrix-builder"
            class="font-medium text-brand-700 hover:text-brand-600"
            >About</a
          >
        </div>
      </footer>
    </main>

    <script>
      const criteriaList = document.getElementById("criteria-list");
      const optionsList = document.getElementById("options-list");
      const matrix = document.getElementById("matrix");
      const addCriterionButton = document.getElementById("add-criterion");
      const addOptionButton = document.getElementById("add-option");

      let criteria = [
        { id: crypto.randomUUID(), name: "Impact", weight: 5 },
        { id: crypto.randomUUID(), name: "Effort", weight: 3 },
        { id: crypto.randomUUID(), name: "Risk", weight: 2 },
      ];
      let options = [
        { id: crypto.randomUUID(), name: "Option A" },
        { id: crypto.randomUUID(), name: "Option B" },
      ];
      let scores = {};

      const ensureScore = (optionId, criterionId) => {
        if (!scores[optionId]) {
          scores[optionId] = {};
        }
        if (scores[optionId][criterionId] === undefined) {
          scores[optionId][criterionId] = 0;
        }
      };

      const totalWeight = () =>
        criteria.reduce((sum, criterion) => sum + Number(criterion.weight || 0), 0);

      const weightedTotal = (optionId) => {
        const weightSum = totalWeight();
        if (weightSum === 0) return 0;
        return criteria.reduce((sum, criterion) => {
          const score = Number(scores[optionId]?.[criterion.id] || 0);
          return sum + score * Number(criterion.weight || 0);
        }, 0);
      };

      const updateState = (updateFn) => {
        updateFn();
        render();
      };

      const renderCriteria = () => {
        criteriaList.innerHTML = "";
        criteria.forEach((criterion) => {
          const row = document.createElement("div");
          row.className = "grid grid-cols-[1fr,96px,40px] gap-2";

          const nameInput = document.createElement("input");
          nameInput.className =
            "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm";
          nameInput.value = criterion.name;
          nameInput.placeholder = "Criterion";
          nameInput.addEventListener("input", (event) => {
            criterion.name = event.target.value;
            renderMatrix();
          });

          const weightInput = document.createElement("input");
          weightInput.className =
            "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm";
          weightInput.type = "number";
          weightInput.min = "0";
          weightInput.step = "0.1";
          weightInput.value = criterion.weight;
          weightInput.addEventListener("input", (event) => {
            criterion.weight = Number(event.target.value || 0);
            renderMatrix();
          });

          const removeButton = document.createElement("button");
          removeButton.className = "btn btn-secondary";
          removeButton.textContent = "×";
          removeButton.addEventListener("click", () => {
            updateState(() => {
              criteria = criteria.filter((item) => item.id !== criterion.id);
              options.forEach((option) => {
                if (scores[option.id]) {
                  delete scores[option.id][criterion.id];
                }
              });
            });
          });

          row.append(nameInput, weightInput, removeButton);
          criteriaList.appendChild(row);
        });
      };

      const renderOptions = () => {
        optionsList.innerHTML = "";
        options.forEach((option) => {
          const row = document.createElement("div");
          row.className = "grid grid-cols-[1fr,40px] gap-2";

          const nameInput = document.createElement("input");
          nameInput.className =
            "w-full rounded-lg border border-slate-200 px-3 py-2 text-sm";
          nameInput.value = option.name;
          nameInput.placeholder = "Option";
          nameInput.addEventListener("input", (event) => {
            option.name = event.target.value;
            renderMatrix();
          });

          const removeButton = document.createElement("button");
          removeButton.className = "btn btn-secondary";
          removeButton.textContent = "×";
          removeButton.addEventListener("click", () => {
            updateState(() => {
              options = options.filter((item) => item.id !== option.id);
              delete scores[option.id];
            });
          });

          row.append(nameInput, removeButton);
          optionsList.appendChild(row);
        });
      };

      const renderMatrix = () => {
        if (criteria.length === 0 || options.length === 0) {
          matrix.innerHTML =
            '<div class="rounded-lg border border-dashed border-slate-200 p-6 text-center text-sm text-slate-500">Add at least one criterion and one option to score.</div>';
          return;
        }

        const table = document.createElement("table");
        table.className = "w-full border-collapse text-sm";

        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        const blankHeader = document.createElement("th");
        blankHeader.className = "p-2 text-left text-slate-500";
        blankHeader.textContent = "Option";
        headerRow.appendChild(blankHeader);

        criteria.forEach((criterion) => {
          const th = document.createElement("th");
          th.className = "p-2 text-center text-slate-500";
          th.textContent = `${criterion.name || "Criterion"} (${criterion.weight})`;
          headerRow.appendChild(th);
        });

        const totalHeader = document.createElement("th");
        totalHeader.className = "p-2 text-center text-slate-500";
        totalHeader.textContent = "Weighted Total";
        headerRow.appendChild(totalHeader);
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        options.forEach((option) => {
          const row = document.createElement("tr");
          row.className = "border-t border-slate-100";

          const nameCell = document.createElement("td");
          nameCell.className = "p-2 font-medium text-slate-700";
          nameCell.textContent = option.name || "Option";
          row.appendChild(nameCell);

          criteria.forEach((criterion) => {
            ensureScore(option.id, criterion.id);
            const cell = document.createElement("td");
            cell.className = "p-2 text-center";

            const input = document.createElement("input");
            input.className =
              "w-20 rounded-lg border border-slate-200 px-2 py-1 text-center text-sm";
            input.type = "number";
            input.min = "0";
            input.step = "0.1";
            input.value = scores[option.id][criterion.id];
            input.addEventListener("input", (event) => {
              scores[option.id][criterion.id] = Number(event.target.value || 0);
              renderMatrix();
            });

            cell.appendChild(input);
            row.appendChild(cell);
          });

          const totalCell = document.createElement("td");
          totalCell.className = "p-2 text-center font-semibold text-brand-700";
          totalCell.textContent = weightedTotal(option.id).toFixed(1);
          row.appendChild(totalCell);

          tbody.appendChild(row);
        });
        table.appendChild(tbody);

        const weightRow = document.createElement("div");
        weightRow.className =
          "mt-3 flex items-center justify-between text-xs text-slate-500";
        weightRow.textContent = `Total weight: ${totalWeight().toFixed(1)}`;

        matrix.innerHTML = "";
        matrix.appendChild(table);
        matrix.appendChild(weightRow);
      };

      const render = () => {
        renderCriteria();
        renderOptions();
        renderMatrix();
      };

      addCriterionButton.addEventListener("click", () => {
        updateState(() => {
          criteria.push({
            id: crypto.randomUUID(),
            name: `Criterion ${criteria.length + 1}`,
            weight: 1,
          });
        });
      });

      addOptionButton.addEventListener("click", () => {
        updateState(() => {
          options.push({
            id: crypto.randomUUID(),
            name: `Option ${options.length + 1}`,
          });
        });
      });

      render();
    </script>
  </body>
</html>
