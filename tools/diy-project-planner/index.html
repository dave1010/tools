<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DIY Project Planner</title>
  <link rel="stylesheet" href="/assets/tw.css">
</head>
<body class="bg-gray-50 text-gray-900">
  <main class="mx-auto max-w-3xl p-4 md:p-6 space-y-4 font-sans">
    <header class="space-y-2 text-center">
      <p class="text-sm font-semibold uppercase tracking-wide text-brand-700">DIY Toolkit</p>
      <h1 class="text-3xl font-semibold">DIY Project Planner</h1>
      <p class="text-gray-600">Map out steps, time, and materials so your next build is organized before you grab the tools.</p>
    </header>

    <section class="rounded-2xl border border-gray-200 bg-white p-6 shadow-soft space-y-4 md:p-8">
      <div class="grid gap-4 md:grid-cols-3">
        <div class="space-y-2 md:col-span-2">
          <label for="projectTitle" class="text-sm font-medium text-gray-700">Project name</label>
          <input id="projectTitle" type="text" value="Outdoor planter box" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
          <p class="text-xs text-gray-500">Keep it specific so you can reuse this planner for other builds.</p>
        </div>
        <div class="space-y-2">
          <label for="projectFocus" class="text-sm font-medium text-gray-700">Focus</label>
          <select id="projectFocus" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
            <option value="woodworking" selected>Woodworking</option>
            <option value="home-repair">Home repair</option>
            <option value="electrical">Electrical</option>
            <option value="outdoor">Outdoor</option>
            <option value="crafts">Crafts</option>
          </select>
        </div>
      </div>

      <div class="grid gap-4 md:grid-cols-3">
        <article class="rounded-xl bg-brand-50 p-4 text-brand-900 shadow-inner">
          <p class="text-xs font-semibold uppercase tracking-wide">Estimated Hours</p>
          <p id="totalHours" class="mt-2 text-3xl font-semibold">0</p>
          <p class="text-sm text-brand-800">Summed from every step.</p>
        </article>
        <article class="rounded-xl bg-gray-100 p-4 text-gray-900 shadow-inner">
          <p class="text-xs font-semibold uppercase tracking-wide text-gray-700">Materials Budget</p>
          <p id="totalCost" class="mt-2 text-3xl font-semibold">$0</p>
          <p class="text-sm text-gray-700">Live tally of listed items.</p>
        </article>
        <article class="rounded-xl bg-white p-4 shadow-inner border border-gray-200">
          <div class="flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-gray-700">
            <span>Readiness</span>
            <span id="readinessLabel" class="text-brand-700">0%</span>
          </div>
          <div class="mt-3 h-3 w-full rounded-full bg-gray-100">
            <div id="readinessBar" class="h-full rounded-full bg-brand-500 transition-all" style="width: 0%"></div>
          </div>
          <p id="readinessTip" class="mt-2 text-sm text-gray-700">Add a few steps to start the plan.</p>
        </article>
      </div>
    </section>

    <section class="rounded-2xl border border-gray-200 bg-white p-6 shadow-soft space-y-4 md:p-8">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
          <h2 class="text-xl font-semibold">Build steps</h2>
          <p class="text-sm text-gray-600">Add time estimates to see how long the project will take.</p>
        </div>
        <button id="resetSteps" class="btn btn-secondary">Reset to defaults</button>
      </div>

      <div class="grid gap-4 md:grid-cols-[2fr_1fr_1fr_auto]">
        <div class="space-y-2">
          <label for="stepName" class="text-sm font-medium text-gray-700">Step</label>
          <input id="stepName" type="text" placeholder="Cut boards to length" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
        </div>
        <div class="space-y-2">
          <label for="stepDuration" class="text-sm font-medium text-gray-700">Hours</label>
          <input id="stepDuration" type="number" min="0" step="0.25" value="1" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
        </div>
        <div class="space-y-2">
          <label for="stepStage" class="text-sm font-medium text-gray-700">Phase</label>
          <select id="stepStage" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
            <option value="Planning" selected>Planning</option>
            <option value="Cutting">Cutting</option>
            <option value="Assembly">Assembly</option>
            <option value="Finish">Finish</option>
            <option value="Clean up">Clean up</option>
          </select>
        </div>
        <div class="self-end">
          <button id="addStep" class="btn btn-primary w-full">Add step</button>
        </div>
      </div>

      <ul id="stepsList" class="divide-y divide-gray-200 rounded-xl border border-gray-200 bg-gray-50">
      </ul>
    </section>

    <section class="rounded-2xl border border-gray-200 bg-white p-6 shadow-soft space-y-4 md:p-8">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
          <h2 class="text-xl font-semibold">Materials &amp; supplies</h2>
          <p class="text-sm text-gray-600">Track what to buy and what is already in the shop.</p>
        </div>
        <button id="resetMaterials" class="btn btn-secondary">Reset list</button>
      </div>

      <div class="grid gap-4 md:grid-cols-[2fr_1fr_1fr_auto]">
        <div class="space-y-2">
          <label for="materialName" class="text-sm font-medium text-gray-700">Item</label>
          <input id="materialName" type="text" placeholder="Exterior screws" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
        </div>
        <div class="space-y-2">
          <label for="materialQty" class="text-sm font-medium text-gray-700">Quantity</label>
          <input id="materialQty" type="number" min="0" step="1" value="1" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
        </div>
        <div class="space-y-2">
          <label for="materialCost" class="text-sm font-medium text-gray-700">Unit cost</label>
          <input id="materialCost" type="number" min="0" step="0.01" value="10" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
        </div>
        <div class="self-end">
          <button id="addMaterial" class="btn btn-primary w-full">Add item</button>
        </div>
      </div>

      <div class="overflow-hidden rounded-xl border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-100 text-xs uppercase tracking-wide text-gray-600">
            <tr>
              <th class="px-3 py-2 text-left font-semibold">Item</th>
              <th class="px-3 py-2 text-left font-semibold">Qty</th>
              <th class="px-3 py-2 text-left font-semibold">Unit</th>
              <th class="px-3 py-2 text-left font-semibold">Total</th>
              <th class="px-3 py-2 text-left font-semibold">Status</th>
              <th class="px-3 py-2 text-right font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody id="materialsTable" class="divide-y divide-gray-200 bg-white"></tbody>
        </table>
      </div>
    </section>

    <section class="rounded-2xl border border-gray-200 bg-white p-6 shadow-soft space-y-4 md:p-8">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
          <h2 class="text-xl font-semibold">Prep checklist</h2>
          <p class="text-sm text-gray-600">Quick hits to stay safe, stocked, and on schedule.</p>
        </div>
        <button id="markAllReady" class="btn btn-secondary">Mark all ready</button>
      </div>

      <div id="checklist" class="grid gap-3 md:grid-cols-2"></div>
    </section>

    <footer class="py-6 text-center text-sm text-gray-500">
      <div class="flex justify-center gap-4">
        <a href="/" class="font-medium text-brand-700 hover:text-brand-600">‚Üê Back to tools.dave.engineer</a>
        <a href="https://github.com/dave1010/tools/tree/main/tools/diy-project-planner" class="font-medium text-brand-700 hover:text-brand-600">About</a>
      </div>
    </footer>
  </main>

  <script>
    const stepsList = document.getElementById("stepsList");
    const materialsTable = document.getElementById("materialsTable");
    const projectTitleInput = document.getElementById("projectTitle");
    const projectFocusSelect = document.getElementById("projectFocus");
    const stepName = document.getElementById("stepName");
    const stepDuration = document.getElementById("stepDuration");
    const stepStage = document.getElementById("stepStage");
    const materialName = document.getElementById("materialName");
    const materialQty = document.getElementById("materialQty");
    const materialCost = document.getElementById("materialCost");

    const totalHoursEl = document.getElementById("totalHours");
    const totalCostEl = document.getElementById("totalCost");
    const readinessBar = document.getElementById("readinessBar");
    const readinessLabel = document.getElementById("readinessLabel");
    const readinessTip = document.getElementById("readinessTip");

    const checklistContainer = document.getElementById("checklist");

    const checklistItems = [
      { id: "tools", label: "Tools laid out", description: "Set clamps, drill bits, safety gear where you can grab them.", done: false },
      { id: "measure", label: "Measurements double-checked", description: "Confirm cuts on paper before touching lumber.", done: false },
      { id: "materials", label: "Materials purchased", description: "Every item in the list is accounted for.", done: false },
      { id: "prep", label: "Prep space", description: "Clear a stable work area and add drop cloths if needed.", done: false },
      { id: "safety", label: "Safety ready", description: "Eye/ear protection and dust collection ready to go.", done: false },
      { id: "cleanup", label: "Cleanup plan", description: "Shop-vac, bin bags, and scrap pile spot chosen.", done: false }
    ];

    let steps = [];
    let materials = [];

    const defaultSteps = [
      { id: crypto.randomUUID(), name: "Sketch cut list & measurements", duration: 1.0, stage: "Planning", done: false },
      { id: crypto.randomUUID(), name: "Cut boards to size", duration: 1.5, stage: "Cutting", done: false },
      { id: crypto.randomUUID(), name: "Assemble frame with screws", duration: 1.25, stage: "Assembly", done: false },
      { id: crypto.randomUUID(), name: "Sand edges and surfaces", duration: 0.75, stage: "Finish", done: false }
    ];

    const defaultMaterials = [
      { id: crypto.randomUUID(), name: "1x6 cedar boards", quantity: 6, unitCost: 12.5, status: "Ready" },
      { id: crypto.randomUUID(), name: "Exterior screws (box)", quantity: 1, unitCost: 8, status: "Need" },
      { id: crypto.randomUUID(), name: "Outdoor sealant", quantity: 1, unitCost: 14, status: "Need" },
      { id: crypto.randomUUID(), name: "Sandpaper sheets", quantity: 5, unitCost: 0.8, status: "Ready" }
    ];

    function resetSteps() {
      steps = defaultSteps.map(step => ({ ...step, id: crypto.randomUUID(), done: false }));
      renderSteps();
      updateSummary();
    }

    function resetMaterials() {
      materials = defaultMaterials.map(item => ({ ...item, id: crypto.randomUUID() }));
      renderMaterials();
      updateSummary();
      syncChecklist();
    }

    function formatHours(value) {
      return Number.isFinite(value) ? `${value.toFixed(2).replace(/\.00$/, "")} hrs` : "0 hrs";
    }

    function formatCurrency(value) {
      return Number.isFinite(value) ? `$${value.toFixed(2)}` : "$0.00";
    }

    function addStep() {
      const name = stepName.value.trim();
      const duration = Number.parseFloat(stepDuration.value);
      const stage = stepStage.value;
      if (!name || !Number.isFinite(duration) || duration <= 0) return;
      steps.push({ id: crypto.randomUUID(), name, duration, stage, done: false });
      stepName.value = "";
      stepDuration.value = "1";
      stepStage.value = "Planning";
      renderSteps();
      updateSummary();
    }

    function toggleStep(id) {
      steps = steps.map(step => step.id === id ? { ...step, done: !step.done } : step);
      renderSteps();
      updateSummary();
    }

    function removeStep(id) {
      steps = steps.filter(step => step.id !== id);
      renderSteps();
      updateSummary();
    }

    function addMaterial() {
      const name = materialName.value.trim();
      const quantity = Number.parseFloat(materialQty.value);
      const unitCost = Number.parseFloat(materialCost.value);
      if (!name || !Number.isFinite(quantity) || quantity <= 0 || !Number.isFinite(unitCost) || unitCost < 0) return;
      materials.push({ id: crypto.randomUUID(), name, quantity, unitCost, status: "Need" });
      materialName.value = "";
      materialQty.value = "1";
      materialCost.value = "10";
      renderMaterials();
      updateSummary();
      syncChecklist();
    }

    function updateMaterialStatus(id, status) {
      materials = materials.map(item => item.id === id ? { ...item, status } : item);
      renderMaterials();
      syncChecklist();
    }

    function removeMaterial(id) {
      materials = materials.filter(item => item.id !== id);
      renderMaterials();
      updateSummary();
      syncChecklist();
    }

    function renderSteps() {
      stepsList.innerHTML = "";
      if (steps.length === 0) {
        stepsList.innerHTML = `<li class="p-4 text-center text-sm text-gray-500">Add steps above to see your plan.</li>`;
        return;
      }

      steps.forEach(step => {
        const li = document.createElement("li");
        li.className = "flex flex-col gap-3 p-4 transition hover:bg-white md:flex-row md:items-center";
        li.innerHTML = `
          <div class="flex flex-1 items-start gap-3">
            <input type="checkbox" ${step.done ? "checked" : ""} class="mt-1 h-4 w-4 rounded border-gray-300 text-brand-600 focus:ring-brand-500" data-action="toggle" data-id="${step.id}">
            <div>
              <div class="flex items-center gap-2">
                <p class="font-medium ${step.done ? "text-gray-500 line-through" : "text-gray-900"}">${step.name}</p>
                <span class="rounded-full bg-brand-100 px-2 py-1 text-xs font-semibold text-brand-700">${step.stage}</span>
              </div>
              <p class="text-sm text-gray-600">${formatHours(step.duration)}</p>
            </div>
          </div>
          <div class="flex items-center gap-2 md:justify-end">
            <button class="btn btn-secondary" data-action="toggle" data-id="${step.id}">${step.done ? "Undo" : "Done"}</button>
            <button class="btn" data-action="remove" data-id="${step.id}">Remove</button>
          </div>
        `;
        stepsList.appendChild(li);
      });
    }

    function renderMaterials() {
      materialsTable.innerHTML = "";
      if (materials.length === 0) {
        materialsTable.innerHTML = `<tr><td colspan="6" class="px-3 py-4 text-center text-sm text-gray-500">List supplies to track budget and gaps.</td></tr>`;
        return;
      }

      materials.forEach(item => {
        const total = item.quantity * item.unitCost;
        const row = document.createElement("tr");
        row.className = "hover:bg-gray-50";
        row.innerHTML = `
          <td class="px-3 py-3 font-medium text-gray-900">${item.name}</td>
          <td class="px-3 py-3 text-gray-700">${item.quantity}</td>
          <td class="px-3 py-3 text-gray-700">${formatCurrency(item.unitCost)}</td>
          <td class="px-3 py-3 text-gray-900">${formatCurrency(total)}</td>
          <td class="px-3 py-3">
            <select data-action="status" data-id="${item.id}" class="rounded-lg border border-gray-300 px-2 py-1 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200">
              <option value="Need" ${item.status === "Need" ? "selected" : ""}>Need</option>
              <option value="Ready" ${item.status === "Ready" ? "selected" : ""}>Ready</option>
              <option value="Ordered" ${item.status === "Ordered" ? "selected" : ""}>Ordered</option>
            </select>
          </td>
          <td class="px-3 py-3 text-right">
            <button class="btn btn-secondary" data-action="remove" data-id="${item.id}">Remove</button>
          </td>
        `;
        materialsTable.appendChild(row);
      });
    }

    function updateSummary() {
      const totalHours = steps.reduce((sum, step) => sum + (step.duration || 0), 0);
      const totalCost = materials.reduce((sum, item) => sum + (item.quantity * item.unitCost || 0), 0);
      const doneSteps = steps.filter(step => step.done).length;
      const readinessScore = calculateReadiness(totalHours, totalCost, doneSteps);

      totalHoursEl.textContent = formatHours(totalHours);
      totalCostEl.textContent = formatCurrency(totalCost);
      readinessBar.style.width = `${readinessScore}%`;
      readinessLabel.textContent = `${readinessScore}%`;
      readinessTip.textContent = readinessCopy(readinessScore, doneSteps, materials.length);
    }

    function calculateReadiness(totalHours, totalCost, doneSteps) {
      const hasPlan = steps.length > 0 ? 25 : 0;
      const hasMaterials = materials.length > 0 ? 25 : 0;
      const progress = steps.length ? Math.round((doneSteps / steps.length) * 30) : 0;
      const budgeted = totalCost > 0 ? 20 : 0;
      return Math.min(100, hasPlan + hasMaterials + progress + budgeted);
    }

    function readinessCopy(score, doneSteps, materialCount) {
      if (score >= 90) return "Ready to roll. Sweep the floor and start!";
      if (score >= 70) return "Materials are in good shape. Double-check safety gear.";
      if (materialCount === 0) return "Add materials so you do not pause mid-build.";
      if (doneSteps === 0) return "Mark steps as done as you progress.";
      return "Keep adding details to tighten the plan.";
    }

    function syncChecklist() {
      const materialsReady = materials.every(item => item.status === "Ready" || item.status === "Ordered");
      updateChecklistState("materials", materialsReady);
      updateChecklistState("measure", steps.length > 0);
      const projectNamed = projectTitleInput.value.trim().length > 0;
      updateChecklistState("tools", projectNamed);
      updateChecklistState("prep", materials.length > 0);
      updateChecklistState("safety", steps.some(step => step.stage === "Cutting" || step.stage === "Assembly"));
      updateChecklistState("cleanup", steps.some(step => step.stage === "Finish" || step.stage === "Clean up"));
    }

    function updateChecklistState(id, done) {
      const item = checklistItems.find(entry => entry.id === id);
      if (item) item.done = done;
      renderChecklist();
    }

    function renderChecklist() {
      checklistContainer.innerHTML = "";
      checklistItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "flex gap-3 rounded-xl border border-gray-200 bg-gray-50 p-4";
        card.innerHTML = `
          <input type="checkbox" ${item.done ? "checked" : ""} data-id="${item.id}" class="mt-1 h-4 w-4 rounded border-gray-300 text-brand-600 focus:ring-brand-500" />
          <div>
            <p class="font-medium ${item.done ? "text-gray-500 line-through" : "text-gray-900"}">${item.label}</p>
            <p class="text-sm text-gray-600">${item.description}</p>
          </div>
        `;
        checklistContainer.appendChild(card);
      });
    }

    document.getElementById("addStep").addEventListener("click", addStep);
    document.getElementById("resetSteps").addEventListener("click", resetSteps);
    stepsList.addEventListener("click", (event) => {
      const id = event.target.getAttribute("data-id");
      const action = event.target.getAttribute("data-action");
      if (!id || !action) return;
      if (action === "toggle") toggleStep(id);
      if (action === "remove") removeStep(id);
    });

    document.getElementById("addMaterial").addEventListener("click", addMaterial);
    document.getElementById("resetMaterials").addEventListener("click", resetMaterials);
    materialsTable.addEventListener("change", (event) => {
      const id = event.target.getAttribute("data-id");
      const action = event.target.getAttribute("data-action");
      if (action === "status" && id) {
        updateMaterialStatus(id, event.target.value);
      }
    });
    materialsTable.addEventListener("click", (event) => {
      const id = event.target.getAttribute("data-id");
      const action = event.target.getAttribute("data-action");
      if (action === "remove" && id) removeMaterial(id);
    });

    document.getElementById("markAllReady").addEventListener("click", () => {
      checklistItems.forEach(item => item.done = true);
      renderChecklist();
    });

    checklistContainer.addEventListener("change", (event) => {
      const id = event.target.getAttribute("data-id");
      const checked = event.target.checked;
      const item = checklistItems.find(entry => entry.id === id);
      if (item) item.done = checked;
      renderChecklist();
    });

    [projectTitleInput, projectFocusSelect].forEach(input => {
      input.addEventListener("input", () => {
        syncChecklist();
        updateSummary();
      });
    });

    resetSteps();
    resetMaterials();
    renderChecklist();
    syncChecklist();
    updateSummary();
  </script>
</body>
</html>
